# Power BI Best Practice Analyzer Results Viewer

Interactive HTML visualization tool for Tabular Editor's Best Practice Analyzer (BPA) results from TRX files.

## Overview

This tool parses Visual Studio Test Results (TRX) files generated by Tabular Editor's BPA CLI and creates an interactive HTML dashboard showing rule violations, warnings, and pass rates across one or multiple Power BI semantic models.

### Key Features

**üîç Multi-Model Results**
- **Automatic Discovery**: Recursively scans directories for all `.trx` files‚Äîno manual configuration
- **Multi-Model Dropdown**: Single HTML file contains all BPA results; switch between models instantly
- **Flexible Input**: Point to any directory or specific TRX file

**üéØ Interactive Filtering & Analysis**
- **Severity Filters**: Toggle Error/Warning/Informational violations on/off
- **Category Filters**: Filter by BPA rule categories (DAX Expressions, Formatting, Maintenance, Performance, Error Prevention)
- **Object Type Filters**: Focus on specific object types (Measures, Tables, Columns, Relationships)
- **Search Box**: Find specific violations by keyword
- **Pass Rate Statistics**: Visual progress bar showing compliance percentage

**üìä Smart Visual Design**
- **Severity Badges**: Color-coded (Red=Error, Orange=Warning, Blue=Info)
- **Expandable Details**: Click any violation to see full description and affected objects
- **Compliance Summary**: Real-time stats panel showing totals by severity
- **Rule Metadata**: See rule IDs, categories, severity levels, and recommendations
- **Object Lists**: Click to expand and view all affected measures, tables, or columns

**üé® Production-Ready Output**
- **Self-Contained HTML**: Single file with all data and interactivity embedded
- **Offline Capable**: No external dependencies‚Äîworks without internet connection
- **Shareable**: Send to stakeholders, embed in documentation, store in wikis
- **CI/CD Friendly**: Generate compliance reports automatically in build pipelines

## Prerequisites

- **Python**: 3.7 or higher
- **Dependencies**: None (uses Python standard library only)
- **Input Format**: TRX files generated by Tabular Editor CLI Best Practice Analyzer

## Installation

No installation required. Simply download the script:

```bash
curl -O https://raw.githubusercontent.com/YourRepo/visualize_bpa_results.py
```

Or clone the repository containing this script.

## Usage

### Basic Usage

**Scan current directory recursively:**

```bash
python visualize_bpa_results.py
```

This will:
1. Recursively search from the current directory for all `.trx` files
2. Parse BPA results from each TRX file
3. Generate `bpa_results_viewer.html` in the current directory
4. Automatically open the HTML file in your default browser

### Advanced Options

**Specify input directory:**
```bash
python visualize_bpa_results.py --input ./bpa_results
```

**Specify output location:**
```bash
python visualize_bpa_results.py --output ./reports/bpa_report.html
```

**Skip opening browser:**
```bash
python visualize_bpa_results.py --no-browser
```

**Combine options:**
```bash
python visualize_bpa_results.py \
  --input ./test_results \
  --output ./reports/compliance_report.html \
  --no-browser
```

### Command-Line Options

| Option | Description | Default |
|--------|-------------|---------|
| `--input <path>`, `-i` | Directory containing TRX files (or path to single TRX file) | Current directory (recursive search) |
| `--output <path>`, `-o` | Output HTML file path | `bpa_results_viewer.html` in input directory |
| `--no-browser` | Skip automatically opening HTML in browser | Opens browser |

## Generating TRX Files with Tabular Editor CLI

To create the input files for this viewer, run Tabular Editor's BPA from the command line:

```bash
# Run BPA on a PBIP model (TMDL format)
TabularEditor3.exe `
  "C:\path\to\YourModel.SemanticModel" `
  -BPA `
  -TRX "C:\output\bpa_results.trx"

# Run BPA on a .bim file
TabularEditor3.exe `
  "C:\path\to\model.bim" `
  -BPA `
  -TRX "C:\output\bpa_results.trx"
```

### Example: Batch Processing Multiple Models

```powershell
# PowerShell script to analyze all models in a directory
$models = Get-ChildItem -Path ".\datasets" -Filter "*.SemanticModel" -Recurse
foreach ($model in $models) {
    $outputName = "$($model.BaseName)_$(Get-Date -Format 'yyyyMMdd_HHmmss').trx"
    TabularEditor3.exe $model.FullName -BPA -TRX ".\bpa_results\$outputName"
}

# Generate interactive viewer
python visualize_bpa_results.py --input ./bpa_results
```

## Expected Folder Structure

The script works with any folder structure containing TRX files:

```
your_project/
‚îú‚îÄ‚îÄ bpa_results/
‚îÇ   ‚îú‚îÄ‚îÄ SalesModel_20241122_143022.trx    ‚Üê Parsed by this tool
‚îÇ   ‚îú‚îÄ‚îÄ FinanceModel_20241122_143045.trx  ‚Üê Parsed by this tool
‚îÇ   ‚îî‚îÄ‚îÄ InventoryModel_20241122_143108.trx ‚Üê Parsed by this tool
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ Sales.SemanticModel/
‚îÇ   ‚îú‚îÄ‚îÄ Finance.SemanticModel/
‚îÇ   ‚îî‚îÄ‚îÄ Inventory.SemanticModel/
‚îî‚îÄ‚îÄ visualize_bpa_results.py
```

The script recursively searches for any `*.trx` files regardless of folder depth.

## Interactive Viewer Features

### Visualization Elements

- **Model Selector**: Dropdown to switch between different BPA test runs
- **Pass Rate Bar**: Visual progress indicator showing compliance percentage
- **Severity Badges**: 
  - üü° **Info (Severity 1)** (yellow badge) - Best practice recommendations
  - üü† **Warning (Severity 2)** (orange badge) - Important but non-critical issues
  - üî¥ **Error (Severity 3)** (red badge) - Critical issues requiring immediate attention
- **Statistics Panel**: Real-time counts for Total Rules, Passed, Failed, Errors, Warnings, Informational

### Interactive Controls

1. **Model Selector**: Dropdown menu to switch between different BPA test results
2. **Filter Controls**: 
   - **All Rules**: Show all rules (passed and failed)
   - **Failed Only**: Show only rules with violations
   - **Expand All**: Expand all categories, rules, and violation lists
   - **Collapse All**: Collapse all sections
3. **Rule Details**: Each rule shows:
   - Rule name with violation count (e.g., "5 Violations")
   - Severity badge (color-coded)
   - Pass/Fail status
   - Expandable description
4. **Violation Lists**: Click to expand and see:
   - Count of objects in violation (e.g., "5 Objects in Violation")
   - Individual affected objects (measures, tables, columns)

### Statistics Panel

Displays real-time counts for the selected model:
- Total rules evaluated
- Passed rules (green count)
- Failed rules (red count)
- Breakdown by severity: Errors, Warnings, Informational
- Pass rate percentage

## Output

The generated HTML file is **fully self-contained** (no external dependencies) and includes:

- All BPA results embedded as JSON
- Full interactive dashboard
- CSS styling
- JavaScript logic for filtering and interactivity

**File size**: Typically 200KB - 1MB depending on number of violations

## Troubleshooting

### No TRX files found

```
‚ùå No TRX files found in: <path>
   Run BPA analysis first to generate TRX files.
```

**Solution**: 
- Run Tabular Editor CLI with `-BPA` and `-TRX` flags to generate test results
- Verify you're pointing to the correct directory with `--input`
- Check that TRX files have `.trx` extension

### TRX file parsing errors

If a TRX file cannot be parsed, the script will display:
```
  ‚ö† Could not parse file
```

**Common causes**:
- Corrupted or incomplete TRX file
- Non-standard XML format
- Empty test results (no rules evaluated)

**Solution**: Re-run BPA analysis to generate fresh TRX files

### Browser doesn't open

Use the `--no-browser` flag and manually open the output HTML file, or check that you have a default browser configured.

## CI/CD Integration

This tool works seamlessly in automated pipelines:

### GitHub Actions Example

```yaml
name: BPA Compliance Check

on: [push, pull_request]

jobs:
  analyze:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Run BPA Analysis
        run: |
          $models = Get-ChildItem -Filter "*.SemanticModel" -Recurse
          foreach ($model in $models) {
            $output = "bpa_results/$($model.BaseName)_$(Get-Date -Format 'yyyyMMdd_HHmmss').trx"
            TabularEditor3.exe $model.FullName -BPA -TRX $output
          }
      
      - name: Generate BPA Viewer
        run: |
          python visualize_bpa_results.py \
            --input ./bpa_results \
            --output ./bpa_compliance_report.html \
            --no-browser
      
      - name: Upload Report
        uses: actions/upload-artifact@v3
        with:
          name: bpa-compliance-report
          path: ./bpa_compliance_report.html
      
      - name: Fail on Errors
        run: |
          # Parse TRX for errors and fail build if found
          $errorCount = (Select-String -Path "bpa_results/*.trx" -Pattern 'outcome="Failed"').Count
          if ($errorCount -gt 0) { exit 1 }
```

### Azure DevOps Pipeline Example

```yaml
trigger:
  - main

pool:
  vmImage: 'windows-latest'

steps:
- task: PowerShell@2
  displayName: 'Run BPA Analysis'
  inputs:
    targetType: 'inline'
    script: |
      Get-ChildItem -Filter "*.SemanticModel" -Recurse | ForEach-Object {
        $output = "$(Build.ArtifactStagingDirectory)/bpa_$($_.BaseName).trx"
        TabularEditor3.exe $_.FullName -BPA -TRX $output
      }

- task: PythonScript@0
  displayName: 'Generate BPA Viewer'
  inputs:
    scriptSource: 'filePath'
    scriptPath: 'visualize_bpa_results.py'
    arguments: '--input $(Build.ArtifactStagingDirectory) --output $(Build.ArtifactStagingDirectory)/bpa_report.html --no-browser'

- task: PublishBuildArtifacts@1
  inputs:
    pathToPublish: '$(Build.ArtifactStagingDirectory)/bpa_report.html'
    artifactName: 'BPA Compliance Report'
```

## Technical Details

- **Parser**: Custom XML parser using Python's `xml.etree.ElementTree`
- **Input Format**: Visual Studio Test Results (TRX) XML schema
- **Browser Compatibility**: Modern browsers (Chrome, Firefox, Edge, Safari)
- **Data Structure**: JSON-embedded in HTML for offline operation
- **Filtering**: Client-side JavaScript (no server required)

## Related Resources

- [Tabular Editor CLI Documentation](https://docs.tabulareditor.com/te3/Command-line-Options.html)
- [Best Practice Analyzer Rules](https://docs.tabulareditor.com/te3/Best-Practice-Analyzer.html)
- [Power BI PBIP/TMDL Format](https://learn.microsoft.com/en-us/power-bi/developer/projects/projects-overview)
- [TRX File Format Schema](https://learn.microsoft.com/en-us/visualstudio/test/how-to-select-the-test-results-format)

## See Also

- **visualize_all_relationships.py** - Interactive relationship diagram generator for Power BI models
- **rename_pbir_folders.py** - Rename PBIR page/visual folders from GUIDs to readable names
